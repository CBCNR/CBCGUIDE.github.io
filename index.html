<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State & Insurance Settlement Funding Info - CBC Settlement Funding</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        select, input, textarea { margin: 10px; padding: 5px; display: block; }
        #info, #courtTable { margin-top: 20px; border: 1px solid #ccc; padding: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; cursor: pointer; }
        th { background-color: #f2f2f2; }
        .hidden { display: none; }
        .easy { background-color: #d4edda; } /* Green */
        .medium { background-color: #fff3cd; } /* Yellow */
        .hard { background-color: #f8d7da; } /* Red */
        .high { color: green; font-weight: bold; }
        .medium-rate { color: orange; font-weight: bold; }
        .low { color: red; font-weight: bold; }
        #summary { margin-bottom: 20px; font-weight: bold; }
        .filters { display: flex; flex-wrap: wrap; gap: 20px; }
    </style>
</head>
<body>
    <h1>State & Insurance Settlement Funding Info - CBC Settlement Funding</h1>
   
    <h2>State & Insurance Search</h2>
    <label for="state">Select State:</label>
    <select id="state">
        <option value="">--Choose State--</option>
    </select>
   
    <label for="insurance">Select Insurance Company:</label>
    <select id="insurance">
        <option value="">--Choose Insurance--</option>
    </select>
   
    <button onclick="displayInfo()">Search</button>
   
    <div id="info"></div>
   
    <h2>Court Guide (Timelines, Judges, Feedback)</h2>
    <p>Use the dropdowns below to filter the table. Data from your 2018-2025 records.</p>
    
    <div id="summary"></div>
    
    <div class="filters">
        <div>
            <label for="stateFilter">State:</label>
            <select id="stateFilter" onchange="displayCourtGuide()">
                <option value="all">All States</option>
            </select>
        </div>
        
        <div>
            <label for="countyFilter">County:</label>
            <select id="countyFilter" onchange="displayCourtGuide()">
                <option value="all">All Counties</option>
            </select>
        </div>
        
        <div>
            <label for="judgeFilter">Judge:</label>
            <select id="judgeFilter" onchange="displayCourtGuide()">
                <option value="all">All Judges</option>
            </select>
        </div>
    </div>

    <table id="courtTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">Jurisdiction</th>
                <th onclick="sortTable(1)">Judge</th>
                <th onclick="sortTable(2)">Avg Time to Court Date</th>
                <th onclick="sortTable(3)">Avg Future Offset</th>
                <th onclick="sortTable(4)">Difficulty</th>
                <th onclick="sortTable(5)">Approval Rate</th>
                <th onclick="sortTable(6)">Total Cases</th>
                <th onclick="sortTable(7)">Denial/Dismissal Notes</th>
                <th onclick="sortTable(8)">Attorney-Client-IPA Info</th>
            </tr>
        </thead>
        <tbody id="courtBody"></tbody>
    </table>
    
    <button onclick="exportCSV()">Export Table as CSV</button>
   
    <h2>Add New Info</h2>
    <form id="addForm">
        <label for="type">Type:</label>
        <select id="type" onchange="toggleCourtFields()">
            <option value="state">State</option>
            <option value="insurance">Insurance</option>
            <option value="court">Court Guide</option>
        </select>
       
        <label for="name">Name (State/Insurance/Judge):</label>
        <input type="text" id="name"><br>
       
        <label for="jurisdiction" class="courtField hidden">Jurisdiction (e.g., Allegheny County, PA):</label>
        <input type="text" id="jurisdiction" class="courtField hidden"><br>
       
        <label for="avgTimeToDate" class="courtField hidden">Avg Time to Get Court Date (e.g., 4-6 weeks):</label>
        <input type="text" id="avgTimeToDate" class="courtField hidden"><br>
       
        <label for="avgFutureOffset" class="courtField hidden">Avg Future Court Date Offset (e.g., 3 months):</label>
        <input type="text" id="avgFutureOffset" class="courtField hidden"><br>
       
        <label for="difficulty" class="courtField hidden">Judge Difficulty (easy/medium/hard):</label>
        <input type="text" id="difficulty" class="courtField hidden"><br>
       
        <label for="approvalRate" class="courtField hidden">Approval Rate (e.g., 75%):</label>
        <input type="text" id="approvalRate" class="courtField hidden"><br>
       
        <label for="totalCases" class="courtField hidden">Total Cases:</label>
        <input type="number" id="totalCases" class="courtField hidden"><br>
       
        <label for="denialNotes" class="courtField hidden">Denial/Dismissal Notes:</label>
        <textarea id="denialNotes" class="courtField hidden"></textarea><br>
       
        <label for="ipaInfo" class="courtField hidden">Attorney-Client-IPA Info:</label>
        <textarea id="ipaInfo" class="courtField hidden"></textarea><br>
       
        <label for="details">General Details (for State/Insurance):</label>
        <textarea id="details"></textarea><br>
       
        <button type="button" onclick="addInfo()">Add</button>
    </form>
   
    <script>
        let data = {
            states: {
                "California": "Settlement funding in California typically requires court approval and can take 4-6 weeks. Interest rates average 2-3% monthly.",
                "New York": "New York has strict usury laws; funding caps at 40% APR. Average approval time: 2-4 weeks.",
                "Texas": "Texas allows non-recourse funding; no repayment if case lost. Processing time: 3-5 weeks."
            },
            insurances: {
                "Allstate": "Allstate settlements often involve structured annuities; funding available up to 50% of expected value.",
                "State Farm": "State Farm prefers quick settlements; funding companies report 70% approval rate for auto claims.",
                "Geico": "Geico cases fund faster for personal injury; average advance: $10k-50k."
            },
            courtGuide: [
                {
                    jurisdiction: "Cabell County Courthouse, Huntington, WV",
                    judge: "Alfred Ferguson",
                    avgTimeToDate: "Unknown (typically 4-8 weeks for WV)",
                    avgFutureOffset: "1-3 months",
                    difficulty: "Medium",
                    approvalRate: "100%",
                    totalCases: 2,
                    denialNotes: "",
                    ipaInfo: "Standard IPA required; virtual/in-person common"
                },
                {
                    jurisdiction: "Mobile County Courthouse, Mobile, AL",
                    judge: "Various",
                    avgTimeToDate: "Unknown",
                    avgFutureOffset: "Unknown",
                    difficulty: "Easy",
                    approvalRate: "100%",
                    totalCases: 1,
                    denialNotes: "",
                    ipaInfo: "In-person hearings; clear funds use documentation"
                },
                {
                    jurisdiction: "Henry Superior Courthouse, McDonough, GA",
                    judge: "Pandora E. Palmer",
                    avgTimeToDate: "Unknown (GA often 6-10 weeks)",
                    avgFutureOffset: "2-4 months",
                    difficulty: "Easy",
                    approvalRate: "100%",
                    totalCases: 2,
                    denialNotes: "",
                    ipaInfo: "In-person common; strong best-interest emphasis"
                },
                {
                    jurisdiction: "Cobb County Superior Courthouse, Marietta, GA",
                    judge: "Kellie Hill",
                    avgTimeToDate: "Unknown",
                    avgFutureOffset: "Unknown",
                    difficulty: "Easy",
                    approvalRate: "100%",
                    totalCases: 3,
                    denialNotes: "",
                    ipaInfo: "Courtroom 5100; in-person; client appearance key"
                },
                {
                    jurisdiction: "Phelps County Courthouse, Rolla, MO",
                    judge: "Fox",
                    avgTimeToDate: "Unknown",
                    avgFutureOffset: "Unknown",
                    difficulty: "Medium",
                    approvalRate: "100%",
                    totalCases: 1,
                    denialNotes: "",
                    ipaInfo: "2nd Floor; submission or in-person"
                },
                {
                    jurisdiction: "Beaver County Courthouse, Beaver, PA",
                    judge: "Ross / James L. Ross",
                    avgTimeToDate: "Unknown (PA 8-12 weeks common)",
                    avgFutureOffset: "2-5 months",
                    difficulty: "Medium-Hard",
                    approvalRate: "100%",
                    totalCases: 2,
                    denialNotes: "PA scrutiny on priors/docs",
                    ipaInfo: "Courtroom 2/6; in-person; detailed IPA mandatory"
                },
                {
                    jurisdiction: "Tom Green County Courthouse, San Angelo, TX",
                    judge: "Gonzalo Rios / Carmen Symes Dusek",
                    avgTimeToDate: "4-8 weeks (TX average)",
                    avgFutureOffset: "1-3 months",
                    difficulty: "Easy",
                    approvalRate: "100%",
                    totalCases: 3,
                    denialNotes: "",
                    ipaInfo: "In-person; routine approvals with docs"
                },
                {
                    jurisdiction: "Harris County Civil Courthouse, Houston, TX",
                    judge: "Tanya Garrison / Kyle Carter / Fredericka Phillips",
                    avgTimeToDate: "4-7 weeks",
                    avgFutureOffset: "1-4 months",
                    difficulty: "Easy",
                    approvalRate: "100%",
                    totalCases: 5,
                    denialNotes: "",
                    ipaInfo: "157th/125th Districts; Zoom/in-person; standard process"
                },
                // ... your other entries here (I kept only the first few for brevity; paste your full array)
            ]
        };

        // Load from localStorage if exists
        if (localStorage.getItem('settlementData')) {
            data = JSON.parse(localStorage.getItem('settlementData'));
        }

        // Populate original state/insurance dropdowns
        function populateDropdowns() {
            const stateSelect = document.getElementById('state');
            const insuranceSelect = document.getElementById('insurance');
            stateSelect.innerHTML = '<option value="">--Choose State--</option>';
            insuranceSelect.innerHTML = '<option value="">--Choose Insurance--</option>';
            for (let s in data.states) {
                stateSelect.innerHTML += `<option value="${s}">${s}</option>`;
            }
            for (let i in data.insurances) {
                insuranceSelect.innerHTML += `<option value="${i}">${i}</option>`;
            }
        }

        // Populate all three filters for Court Guide
        function populateCourtFilters() {
            const stateFilter = document.getElementById('stateFilter');
            const countyFilter = document.getElementById('countyFilter');
            const judgeFilter = document.getElementById('judgeFilter');

            const states = new Set();
            const counties = new Set();
            const judges = new Set();

            data.courtGuide.forEach(entry => {
                // State (last two letters after comma)
                const stateMatch = entry.jurisdiction.match(/,\s*([A-Z]{2})$/i);
                if (stateMatch) states.add(stateMatch[1].toUpperCase());

                // County (everything before the comma, trim "Courthouse" etc.)
                const countyPart = entry.jurisdiction.split(',')[0].trim()
                    .replace(/Courthouse|Superior|District|County|Judicial Center/gi, '').trim();
                if (countyPart) counties.add(countyPart);

                // Judge
                if (entry.judge && entry.judge.trim()) {
                    entry.judge.split('/').forEach(j => {
                        const clean = j.trim();
                        if (clean && clean !== 'Various') judges.add(clean);
                    });
                }
            });

            // Reset options
            stateFilter.innerHTML = '<option value="all">All States</option>';
            countyFilter.innerHTML = '<option value="all">All Counties</option>';
            judgeFilter.innerHTML = '<option value="all">All Judges</option>';

            // Populate sorted
            [...states].sort().forEach(s => {
                stateFilter.innerHTML += `<option value="${s}">${s}</option>`;
            });

            [...counties].sort().forEach(c => {
                countyFilter.innerHTML += `<option value="${c.toLowerCase()}">${c}</option>`;
            });

            [...judges].sort().forEach(j => {
                judgeFilter.innerHTML += `<option value="${j.toLowerCase()}">${j}</option>`;
            });
        }

        // Display filtered table
        function displayCourtGuide() {
            const selectedState = document.getElementById('stateFilter').value.toUpperCase();
            const selectedCounty = document.getElementById('countyFilter').value.toLowerCase();
            const selectedJudge = document.getElementById('judgeFilter').value.toLowerCase();

            const tbody = document.getElementById('courtBody');
            tbody.innerHTML = '';
            let totalCases = 0, totalApprovals = 0;

            data.courtGuide
                .filter(entry => {
                    let match = true;

                    // State filter
                    if (selectedState !== 'ALL') {
                        const stateMatch = entry.jurisdiction.match(/,\s*([A-Z]{2})$/i);
                        match = match && stateMatch && stateMatch[1].toUpperCase() === selectedState;
                    }

                    // County filter
                    if (selectedCounty !== 'all') {
                        const countyPart = entry.jurisdiction.split(',')[0].trim()
                            .replace(/Courthouse|Superior|District|County|Judicial Center/gi, '').trim().toLowerCase();
                        match = match && countyPart.includes(selectedCounty);
                    }

                    // Judge filter
                    if (selectedJudge !== 'all') {
                        const judgeText = (entry.judge || '').toLowerCase();
                        match = match && judgeText.includes(selectedJudge);
                    }

                    return match;
                })
                .forEach(entry => {
                    const rateNum = parseFloat(entry.approvalRate) || 0;
                    const rateClass = rateNum > 70 ? 'high' : rateNum > 40 ? 'medium-rate' : 'low';
                    const diffClass = entry.difficulty.toLowerCase() === 'easy' ? 'easy' : 
                                      entry.difficulty.toLowerCase() === 'medium' ? 'medium' : 'hard';
                    
                    tbody.innerHTML += `
                        <tr class="${diffClass}">
                            <td>${entry.jurisdiction}</td>
                            <td>${entry.judge || 'N/A'}</td>
                            <td>${entry.avgTimeToDate}</td>
                            <td>${entry.avgFutureOffset}</td>
                            <td>${entry.difficulty}</td>
                            <td class="${rateClass}">${entry.approvalRate}</td>
                            <td>${entry.totalCases || 'N/A'}</td>
                            <td>${entry.denialNotes}</td>
                            <td>${entry.ipaInfo}</td>
                        </tr>
                    `;
                    totalCases += entry.totalCases || 0;
                    totalApprovals += (entry.totalCases * rateNum / 100) || 0;
                });

            if (tbody.innerHTML === '') {
                tbody.innerHTML = '<tr><td colspan="9">No matching entries.</td></tr>';
            }

            const overallRate = totalCases > 0 ? Math.round((totalApprovals / totalCases) * 100) : 0;
            document.getElementById('summary').innerHTML = 
                `Showing ${totalCases} cases | ~${overallRate}% approval (filtered).`;
        }

        // ... keep your sortTable(), exportCSV(), toggleCourtFields(), displayInfo(), addInfo() functions unchanged ...

        // Initial load
        populateDropdowns();       // top state/insurance
        populateCourtFilters();    // all three court filters
        displayCourtGuide();       // show table
    </script>
</body>
</html>
